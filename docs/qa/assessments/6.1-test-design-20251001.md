# Test Design: Story 6.1 - Fix Drawings List Display Bug

**Date**: 2025-10-01
**Designer**: Quinn (Test Architect)
**Story**: 6.1 - Fix Drawings List Display Bug
**Story Type**: Brownfield Bug Fix
**Risk Level**: Medium (UI bug blocking core navigation feature)

---

## Test Strategy Overview

**Test Philosophy**: Bug fix validation requires proving the bug is fixed AND no regressions were introduced. This design balances efficient validation with comprehensive regression coverage.

**Test Distribution**:
- **Total test scenarios**: 18
- **Unit tests**: 2 (11%)
- **Integration tests**: 6 (33%)
- **E2E tests**: 10 (56%)
- **Priority distribution**: P0: 8, P1: 7, P2: 3

**Rationale for E2E-Heavy Strategy**:
- Bug manifests at UI layer (data display inconsistency)
- Root cause likely in data extraction/transformation logic
- Critical user journey blocked (list → viewer navigation)
- Regression risk across filters, pagination, and bulk operations
- Manual E2E testing already planned per story Testing Standards

---

## Test Scenarios by Acceptance Criteria

### AC1: Drawing List Display
**Requirement**: When drawings exist in the database, the table displays all drawings with columns: File Name, Project, Status, Size, Upload Date, Components, Actions

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-INT-001 | Integration | P0 | API returns drawings array with all required fields | Validates backend contract | 1 drawing with all fields populated |
| 6.1-E2E-001 | E2E | P0 | Table renders with all 7 column headers visible | Critical UI structure | Empty state initially |
| 6.1-E2E-002 | E2E | P0 | Single drawing displays in table with all columns populated | Bug fix validation - main issue | 1 drawing in database |
| 6.1-E2E-003 | E2E | P1 | Multiple drawings display in table rows | Scalability validation | 3+ drawings in database |
| 6.1-E2E-004 | E2E | P2 | Large dataset (50+ drawings) renders without performance issues | Performance regression check | 50 drawings |

**Coverage**: 5 scenarios (1 integration, 4 E2E)

---

### AC2: Statistics Consistency
**Requirement**: Statistics cards (Total, Assigned, Unassigned, Processing) match the actual count of drawings displayed in the table

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-UNIT-001 | Unit | P1 | Calculate statistics from drawings array correctly | Pure calculation logic | Mock arrays: 0, 1, 5, 100 drawings |
| 6.1-E2E-005 | E2E | P0 | Statistics cards display counts matching table row count | Bug symptom validation | 1 drawing (reported bug state) |
| 6.1-E2E-006 | E2E | P1 | Statistics update when filters applied | Dynamic consistency check | 10 drawings, various projects/statuses |

**Coverage**: 3 scenarios (1 unit, 2 E2E)

---

### AC3: Navigation to Viewer
**Requirement**: Clicking the "View" icon button on a drawing row successfully navigates to `/drawings/:id` and opens the DrawingViewer component

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-007 | E2E | P0 | Click "View" icon navigates to `/drawings/{id}` URL | Critical navigation path | 1 specific drawing ID |
| 6.1-E2E-008 | E2E | P0 | DrawingViewer component loads and displays drawing | End-to-end journey validation | PDF and image drawing types |
| 6.1-INT-002 | Integration | P1 | DrawingViewer receives correct drawing ID from route params | Component integration | useParams hook integration |

**Coverage**: 3 scenarios (1 integration, 2 E2E)

---

### AC4: Filter Functionality Preserved
**Requirement**: Existing DrawingsListPage filter functionality (by Project and Status) continues to work unchanged

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-009 | E2E | P1 | Filter by Project dropdown filters table rows correctly | Regression prevention | 10 drawings across 3 projects |
| 6.1-E2E-010 | E2E | P1 | Filter by Status dropdown filters table rows correctly | Regression prevention | Drawings with: completed, processing, failed |
| 6.1-INT-003 | Integration | P1 | React Query refetch triggered on filter change | State management validation | Filter state changes |

**Coverage**: 3 scenarios (1 integration, 2 E2E)

---

### AC5: React Query Pattern Compliance
**Requirement**: New data mapping follows existing React Query pattern for list views

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-INT-004 | Integration | P1 | DrawingsListPage uses useQuery with correct key structure | Pattern compliance | Query key: ['drawings', page, filters] |
| 6.1-UNIT-002 | Unit | P2 | Data extraction logic handles undefined/null API responses gracefully | Defensive programming | API returns: null, undefined, empty object |

**Coverage**: 2 scenarios (2 integration)

---

### AC6: DrawingViewer Integration Preserved
**Requirement**: Integration with DrawingViewer component maintains current behavior (pan, zoom, component overlays)

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-011 | E2E | P1 | DrawingViewer pan functionality works after navigation from list | Regression check | Drawing with components |
| 6.1-E2E-012 | E2E | P1 | DrawingViewer zoom functionality works after navigation from list | Regression check | Large drawing file |
| 6.1-E2E-013 | E2E | P2 | Component overlays render on drawing after navigation | Feature integration check | Drawing with 5+ components |

**Coverage**: 3 scenarios (3 E2E)

---

### AC7: API Response Structure Validation
**Requirement**: API response structure is validated and properly typed

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-INT-005 | Integration | P0 | TypeScript types match actual API response shape | Type safety validation | Actual API response |
| 6.1-INT-006 | Integration | P1 | API response includes both `drawings` array and `total` count | Contract validation | Backend API response |

**Coverage**: 2 scenarios (2 integration)

---

### AC8: Console Errors Resolved
**Requirement**: Console errors related to data mapping are resolved

#### Test Scenarios

*Note: This is validated during manual testing and included in E2E test assertions*

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-014 | E2E | P0 | No console errors when drawings list page loads | Bug fix validation | Browser console monitoring |

**Coverage**: 1 scenario (1 E2E - embedded in other E2E tests)

---

### AC9: No Regressions
**Requirement**: No regression in existing DrawingsListPage functionality (filters, pagination, bulk operations)

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-015 | E2E | P1 | Pagination controls navigate between pages correctly | Regression prevention | 25+ drawings (multiple pages) |
| 6.1-E2E-016 | E2E | P1 | Bulk selection checkboxes select multiple drawings | Regression prevention | Select 3 of 10 drawings |
| 6.1-E2E-017 | E2E | P2 | Bulk reassignment dialog opens with selected drawings | Feature integration check | 2 selected drawings |

**Coverage**: 3 scenarios (3 E2E)

---

### AC10: Empty State Validation
**Requirement**: Empty state ("No drawings found") only displays when truly no drawings exist

#### Test Scenarios

| ID | Level | Priority | Test Scenario | Justification | Data Variation |
|----|-------|----------|---------------|---------------|----------------|
| 6.1-E2E-018 | E2E | P0 | Empty state displays when database has 0 drawings | Correct empty state behavior | Empty database |

**Coverage**: 1 scenario (1 E2E)

---

## Test Scenario Summary Table

| AC | Requirement | Unit | Integration | E2E | Total | P0 | P1 | P2 |
|----|-------------|------|-------------|-----|-------|----|----|-----|
| AC1 | Drawing List Display | 0 | 1 | 4 | 5 | 2 | 2 | 1 |
| AC2 | Statistics Consistency | 1 | 0 | 2 | 3 | 1 | 2 | 0 |
| AC3 | Navigation to Viewer | 0 | 1 | 2 | 3 | 2 | 1 | 0 |
| AC4 | Filter Functionality | 0 | 1 | 2 | 3 | 0 | 3 | 0 |
| AC5 | React Query Pattern | 1 | 1 | 0 | 2 | 0 | 1 | 1 |
| AC6 | DrawingViewer Integration | 0 | 0 | 3 | 3 | 0 | 2 | 1 |
| AC7 | API Validation | 0 | 2 | 0 | 2 | 1 | 1 | 0 |
| AC8 | Console Errors | 0 | 0 | 1 | 1 | 1 | 0 | 0 |
| AC9 | No Regressions | 0 | 0 | 3 | 3 | 0 | 2 | 1 |
| AC10 | Empty State | 0 | 0 | 1 | 1 | 1 | 0 | 0 |
| **TOTAL** | **10 ACs** | **2** | **6** | **18** | **26** | **8** | **14** | **4** |

*Note: Total scenarios = 26 due to some scenarios testing multiple ACs*

---

## Risk Coverage Matrix

### Identified Risks from Story

| Risk ID | Risk Description | Probability | Impact | Test Coverage |
|---------|------------------|-------------|--------|---------------|
| RISK-6.1-001 | Bug not actually fixed - data still missing | Medium | High | 6.1-E2E-002, 6.1-E2E-005, 6.1-INT-001 |
| RISK-6.1-002 | Filter functionality broken during fix | Low | High | 6.1-E2E-009, 6.1-E2E-010, 6.1-INT-003 |
| RISK-6.1-003 | Pagination broken during fix | Low | Medium | 6.1-E2E-015 |
| RISK-6.1-004 | TypeScript type mismatch causes runtime errors | Medium | Medium | 6.1-INT-005, 6.1-INT-006 |
| RISK-6.1-005 | Navigation to DrawingViewer broken | Low | High | 6.1-E2E-007, 6.1-E2E-008 |
| RISK-6.1-006 | Statistics calculation incorrect | Medium | Low | 6.1-UNIT-001, 6.1-E2E-005, 6.1-E2E-006 |

**Risk Mitigation Summary**:
- All 6 identified risks have test coverage
- High-impact risks (RISK-001, 002, 005) have P0/P1 tests
- Medium-probability risks have both unit and E2E validation

---

## Recommended Test Execution Order

### Phase 1: Pre-Fix Validation (Reproduce Bug)
**Purpose**: Confirm bug exists before applying fix

1. **6.1-E2E-002**: Verify table is empty despite statistics showing 1 drawing ❌ *Should FAIL*
2. **6.1-E2E-005**: Verify statistics don't match table ❌ *Should FAIL*

### Phase 2: Fast Feedback (Unit + Integration)
**Purpose**: Validate logic changes quickly

3. **6.1-UNIT-001**: Statistics calculation logic (2 min)
4. **6.1-UNIT-002**: Defensive null handling (1 min)
5. **6.1-INT-001**: API contract validation (3 min)
6. **6.1-INT-005**: TypeScript type safety (2 min)
7. **6.1-INT-006**: API response structure (2 min)

**Expected Runtime**: ~10 minutes

### Phase 3: Critical Path Validation (P0 E2E)
**Purpose**: Prove bug is fixed and core functionality works

8. **6.1-E2E-001**: Table structure renders
9. **6.1-E2E-002**: Single drawing displays ✅ *Should PASS after fix*
10. **6.1-E2E-005**: Statistics match table ✅ *Should PASS after fix*
11. **6.1-E2E-007**: Navigation to viewer works
12. **6.1-E2E-008**: DrawingViewer loads correctly
13. **6.1-E2E-014**: No console errors
14. **6.1-E2E-018**: Empty state validates correctly

**Expected Runtime**: ~15 minutes (manual)

### Phase 4: Regression Prevention (P1 Tests)
**Purpose**: Ensure existing features still work

15. **6.1-E2E-003**: Multiple drawings render
16. **6.1-E2E-006**: Statistics update with filters
17. **6.1-E2E-009**: Filter by Project
18. **6.1-E2E-010**: Filter by Status
19. **6.1-E2E-011**: DrawingViewer pan works
20. **6.1-E2E-012**: DrawingViewer zoom works
21. **6.1-E2E-015**: Pagination works
22. **6.1-E2E-016**: Bulk selection works
23. **6.1-INT-002**: Route params integration
24. **6.1-INT-003**: Filter state management
25. **6.1-INT-004**: React Query pattern compliance

**Expected Runtime**: ~20 minutes (manual)

### Phase 5: Optional Enhancements (P2 Tests)
**Purpose**: Nice-to-have validations (time permitting)

26. **6.1-E2E-004**: Large dataset performance
27. **6.1-E2E-013**: Component overlays render
28. **6.1-E2E-017**: Bulk reassignment dialog

**Expected Runtime**: ~10 minutes (manual)

**Total Manual Testing Time**: ~55 minutes

---

## Test Implementation Recommendations

### Immediate (Required for Story Completion)

**Manual E2E Testing Checklist** (Story specifies manual testing required):
- [ ] Execute Phase 1 (Pre-fix) to document bug reproduction
- [ ] Execute Phase 2 (Unit/Integration) after code changes
- [ ] Execute Phase 3 (P0 E2E) to validate bug fix
- [ ] Execute Phase 4 (P1 E2E) to prevent regressions
- [ ] Document results in Dev Agent Record > Completion Notes

**Browser DevTools Investigation** (Story Task 1):
- [ ] Network tab: Inspect `/drawings` API response structure
- [ ] Console tab: Monitor for data mapping errors
- [ ] React DevTools: Inspect component state and props

### Future (Optional Enhancement)

**Playwright E2E Test Suite** (Story mentions as optional):
- Create `frontend/e2e/drawings-list-navigation.spec.ts`
- Automate Phase 3 scenarios (P0 critical path)
- Integrate into CI/CD pipeline for regression prevention

**Recommended Playwright Structure**:
```typescript
describe('Drawings List Display', () => {
  test('6.1-E2E-002: Single drawing displays in table', async ({ page }) => {
    // Given: 1 drawing exists in database
    // When: Navigate to /drawings
    // Then: Table displays 1 row with all columns populated
  });

  test('6.1-E2E-005: Statistics match table content', async ({ page }) => {
    // Given: 1 drawing exists
    // When: Page loads
    // Then: "Total Drawings: 1" AND table shows 1 row
  });
});
```

---

## Coverage Gaps & Mitigations

### Gap 1: No Unit Tests for Data Extraction Logic
**Impact**: Low
**Mitigation**: Data extraction is simple mapping logic tested thoroughly at E2E level
**Recommendation**: If logic becomes complex during fix, add unit test for extraction function

### Gap 2: No Integration Tests for Filter State Management
**Status**: Covered by 6.1-INT-003
**Recommendation**: Consider expanding if filter logic changes during fix

### Gap 3: Performance Testing Minimal
**Impact**: Low (bug fix, not feature)
**Mitigation**: 6.1-E2E-004 validates large dataset
**Recommendation**: Monitor production metrics after deployment

---

## Testing Anti-Patterns to Avoid

❌ **Don't**: Test the same thing at multiple levels
- Example: Don't write unit test for data extraction AND integration test AND E2E test
- Rationale: Waste of effort, slow feedback

✅ **Do**: Test once at the most appropriate level
- Data transformation → Integration test
- User journey → E2E test
- Pure calculation → Unit test

❌ **Don't**: Skip pre-fix validation
- Example: Don't assume bug exists, prove it first
- Rationale: Prevents "fixing" non-existent bugs

✅ **Do**: Reproduce bug before fixing
- Run 6.1-E2E-002 before code changes to confirm bug
- Document failure in story completion notes

---

## Success Criteria

This test design is successful when:

1. ✅ All 10 acceptance criteria have test coverage
2. ✅ P0 tests validate bug fix (main symptom resolved)
3. ✅ P1 tests prevent regressions (filters, pagination, navigation)
4. ✅ Test execution time is reasonable (~55 min manual, ~5 min if automated)
5. ✅ Tests can be executed by any developer (clear instructions)
6. ✅ Risk coverage matrix shows all risks mitigated

---

## Gate YAML Block

*For inclusion in quality gate decision file*

```yaml
test_design:
  scenarios_total: 18
  by_level:
    unit: 2
    integration: 6
    e2e: 10
  by_priority:
    p0: 8
    p1: 7
    p2: 3
  coverage_gaps: []
  risk_coverage:
    risks_identified: 6
    risks_covered: 6
    coverage_percentage: 100%
  estimated_manual_effort: "55 minutes"
  automation_recommended: true
  automation_roi: "High - P0 scenarios run on every deployment"
```

---

**Test Design Approved**: 2025-10-01
**Designer**: Quinn (Test Architect)
**Review Status**: Ready for Implementation

