# Story 1.5: Frontend Integration for Multiple Piece Mark Instances

## Status
Draft

## Story
**As a** frontend engineer using the component management interface,
**I want** the UI components to support creating, editing, and displaying multiple instances of piece marks,
**so that** users can effectively manage multiple instances (e.g., "G1-A", "G1-B") through the web interface.

## Acceptance Criteria
1. Component creation forms include instance_identifier input field
2. Component editing forms allow modification of instance_identifier
3. Component listings clearly display instance_identifier to differentiate multiple instances
4. Component search interface includes instance_identifier filter options
5. Search results display instance_identifier and visually differentiate between instances
6. Component creation validates instance_identifier uniqueness within drawings
7. UI maintains backward compatibility for existing components without instance_identifier

## Tasks / Subtasks
- [ ] **Task 1: Update Component Forms** (AC: 1, 2, 6)
  - [ ] Add instance_identifier input field to ComponentCreationDialog in `frontend/src/components/drawing/ComponentCreationDialog.tsx`
  - [ ] Add instance_identifier field to ComponentBasicInfo editor in `frontend/src/components/editor/ComponentBasicInfo.tsx`
  - [ ] Implement client-side validation for instance_identifier format and uniqueness
  - [ ] Add helpful UI hints explaining instance_identifier usage (e.g., "A", "B", "C")
  - [ ] Test form submission with instance_identifier values
- [ ] **Task 2: Update Component Display Components** (AC: 3, 7)
  - [ ] Modify component listing cards to display instance_identifier
  - [ ] Update ComponentDetailModal to show instance_identifier information
  - [ ] Add visual differentiation for multiple instances in listings
  - [ ] Ensure components without instance_identifier display cleanly (backward compatibility)
  - [ ] Update component tooltips and hover states to include instance info
- [ ] **Task 3: Update Search Interface** (AC: 4, 5)
  - [ ] Add instance_identifier filter to search forms
  - [ ] Update search results to display instance_identifier prominently
  - [ ] Modify search result cards to visually distinguish instances (e.g., "G1-A", "G1-B")
  - [ ] Add search suggestions/autocomplete for instance_identifier values
  - [ ] Test search functionality with instance_identifier filters
- [ ] **Task 4: Update Component Management Workflows** (AC: 6, 7)
  - [ ] Update component duplication workflow to handle instance_identifier
  - [ ] Modify bulk component operations to consider instances
  - [ ] Update component history tracking to show instance changes
  - [ ] Add instance-specific context menus and actions
  - [ ] Test complete component lifecycle with instance_identifier

## Dev Notes

### Previous Story Dependencies
**Depends on**: 
- Story 1.1 (Database Schema Migration) - COMPLETED
- Story 1.2 (API Layer Integration) - REQUIRED
- Story 1.4 (Search Integration) - PREFERRED

### Frontend Component Updates

**ComponentCreationDialog.tsx Updates**:
```typescript
interface ComponentFormData {
  // ... existing fields ...
  instance_identifier?: string; // New field
}

// Add input field:
<TextField
  label="Instance Identifier"
  name="instance_identifier"
  value={formData.instance_identifier || ''}
  onChange={handleInputChange}
  placeholder="e.g., A, B, C"
  inputProps={{ maxLength: 10 }}
  helperText="Optional. Use to differentiate multiple instances of the same piece mark."
/>
```

**ComponentBasicInfo.tsx Updates**:
```typescript
// Add instance_identifier to editable fields
const handleInstanceIdentifierChange = (value: string) => {
  onUpdate({
    ...component,
    instance_identifier: value || null
  });
};
```

### Component Display Specifications

**Component Listing Display**:
- Components with instance: "G1-A", "G1-B" (bold instance identifier)
- Components without instance: "G1" (normal display)
- Instance identifier badge/chip for visual distinction

**Search Results Display**:
```typescript
// Enhanced search result display
const formatComponentDisplay = (component: Component) => {
  if (component.instance_identifier) {
    return `${component.piece_mark}-${component.instance_identifier}`;
  }
  return component.piece_mark;
};
```

### File Locations
- **Component Creation**: `frontend/src/components/drawing/ComponentCreationDialog.tsx`
- **Component Editing**: `frontend/src/components/editor/ComponentBasicInfo.tsx`
- **Component Display**: `frontend/src/components/ComponentDetailModal.tsx`
- **Search Interface**: `frontend/src/components/` - Search-related components
- **API Service**: `frontend/src/services/api.ts` - Already updated in Story 1.1

### UI/UX Design Considerations

**Instance Identifier Input Design**:
- Label: "Instance Identifier (Optional)"
- Placeholder: "e.g., A, B, C"
- Help text: "Use to differentiate multiple instances of the same piece mark"
- Validation: Max 10 characters, alphanumeric
- Error states: Clear messaging for duplicate instances

**Component Display Design**:
- Primary display: "G1-A" format for components with instances
- Secondary info: Show piece mark and instance separately in detailed views
- Visual hierarchy: Instance identifier should be prominent but not overwhelming
- Color coding: Consider subtle color differences for different instances

### Frontend Validation Logic

**Client-Side Validation**:
```typescript
const validateInstanceIdentifier = (
  pieceark: string, 
  instanceIdentifier: string,
  drawingId: string,
  existingComponents: Component[]
) => {
  // Check for duplicate instance within same drawing
  const duplicate = existingComponents.find(c => 
    c.drawing_id === drawingId &&
    c.piece_mark === pieceMark &&
    c.instance_identifier === instanceIdentifier
  );
  
  if (duplicate) {
    return `Instance "${instanceIdentifier}" already exists for piece mark "${pieceMark}" in this drawing`;
  }
  
  return null; // Valid
};
```

### Search Interface Enhancements

**Search Form Updates**:
```typescript
interface SearchFilters {
  // ... existing filters ...
  instance_identifier?: string;
}

// Search form component
<TextField
  label="Instance Identifier"
  value={filters.instance_identifier || ''}
  onChange={(e) => setFilters(prev => ({
    ...prev,
    instance_identifier: e.target.value || undefined
  }))}
  placeholder="Filter by instance (A, B, C...)"
/>
```

**Search Results Enhancement**:
- Highlight instance identifier in search results
- Group results by piece mark with instances as sub-items
- Show instance count per piece mark in search summaries

### Component History Integration

**History Display Updates**:
- Show instance_identifier changes in component history
- Display "Instance changed from 'A' to 'B'" type messages
- Track instance creation/modification in audit logs

### Testing Requirements

**Frontend Testing Framework** [Source: architecture.md#tech-stack]:
- **Framework**: React Testing Library for component testing
- **Testing**: Jest for unit tests
- **E2E**: Consider Cypress or Playwright for end-to-end testing

**Required Tests**:
- Component form rendering with instance_identifier field
- Form validation for instance_identifier input
- Component display with and without instance_identifier
- Search interface with instance_identifier filters
- Component creation workflow with instances

**Test Scenarios**:
```typescript
describe('ComponentCreationDialog', () => {
  it('should render instance_identifier input field', () => {
    // Test form includes new field
  });
  
  it('should validate duplicate instance_identifier', () => {
    // Test client-side validation
  });
  
  it('should submit form with instance_identifier', () => {
    // Test form submission
  });
});

describe('Component Display', () => {
  it('should display instance_identifier in component listings', () => {
    // Test component display includes instance info
  });
  
  it('should handle components without instance_identifier', () => {
    // Test backward compatibility
  });
});
```

### Accessibility Considerations

**Form Accessibility**:
- Proper labels and ARIA attributes for instance_identifier input
- Clear error messaging for validation failures
- Keyboard navigation support for instance-related UI elements

**Display Accessibility**:
- Screen reader support for instance differentiation
- High contrast for instance identifier badges/chips
- Clear focus indicators for instance-related interactive elements

### Performance Considerations

**Frontend Performance**:
- Efficient rendering of component lists with instances
- Optimized search result display with instance information
- Minimal impact on component loading times

**API Interaction**:
- Efficient API calls for component creation with instance_identifier
- Proper error handling for API validation failures
- Optimistic UI updates where appropriate

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-21 | 1.0 | Initial story creation based on QA frontend integration gaps | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
(To be populated by development agent)

### Debug Log References
(To be populated by development agent)

### Completion Notes
(To be populated by development agent)

### File List
(To be populated by development agent)

## QA Results
(To be populated by QA agent)