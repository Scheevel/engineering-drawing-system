# Story 3.4B: Advanced Field Configuration

## Status
Ready

## Story
**As a** railroad bridge engineer,
**I want** to configure advanced field validation, dependencies, and complex settings for my schema fields,
**so that** I can enforce business rules and create sophisticated data collection forms for engineering components.

## Acceptance Criteria

1. **Advanced Field Validation Rules**
   - Custom validation patterns (regex) for text fields
   - Advanced number validation (precision, step, currency formatting)
   - Date range validation with business day constraints
   - Cross-field validation and dependencies
   - Custom error messages for validation rules

2. **Complex Field Type Configurations**
   - Select field option management with categories and descriptions
   - Multi-select support with min/max selection limits
   - Textarea advanced settings (resize behavior, rich text preview)
   - Number field advanced settings (units, formatting, calculations)
   - Date field timezone and format configurations

3. **Field Dependencies and Conditional Logic**
   - Show/hide fields based on other field values
   - Required field conditions (conditionally required)
   - Field value calculations and auto-population
   - Validation rule dependencies between fields
   - Field grouping with conditional visibility

4. **Advanced Field Metadata**
   - Field documentation and extended help
   - Field versioning and change tracking
   - Field usage analytics and recommendations
   - Field templates and presets
   - Import/export field configurations

5. **Validation Rule Builder Interface**
   - Visual rule builder for complex validations
   - Rule testing and preview functionality
   - Rule templates for common engineering patterns
   - Rule priority and execution order management
   - Rule debugging and error tracking

6. **Field Configuration Presets**
   - Engineering-specific field templates (dimensions, materials, loads)
   - Industry standard validation patterns
   - Reusable field configuration libraries
   - Configuration sharing between schemas
   - Version control for field configurations

## Tasks / Subtasks

- [ ] **Advanced Validation System** (AC: 1, 5)
  - [ ] Create `src/components/schema-management/FieldValidationBuilder.tsx` component
  - [ ] Create `src/components/schema-management/ValidationRuleEditor.tsx` component
  - [ ] Implement regex pattern builder and tester
  - [ ] Add cross-field validation logic
  - [ ] Create validation rule templates

- [ ] **Complex Field Configuration** (AC: 2)
  - [ ] Create `src/components/schema-management/AdvancedFieldConfig.tsx` component
  - [ ] Implement select option management with categories
  - [ ] Add multi-select configuration support
  - [ ] Create number field advanced settings
  - [ ] Implement date field timezone support

- [ ] **Field Dependencies System** (AC: 3)
  - [ ] Create `src/hooks/schema/useFieldDependencies.ts` hook
  - [ ] Implement conditional field visibility logic
  - [ ] Add field value calculation engine
  - [ ] Create dependency configuration interface
  - [ ] Add field grouping with conditions

- [ ] **Field Metadata Management** (AC: 4)
  - [ ] Create `src/components/schema-management/FieldMetadataEditor.tsx` component
  - [ ] Implement field documentation system
  - [ ] Add field versioning and change tracking
  - [ ] Create field usage analytics
  - [ ] Implement field template system

- [ ] **Configuration Presets System** (AC: 6)
  - [ ] Create `src/components/schema-management/FieldPresetLibrary.tsx` component
  - [ ] Implement engineering field templates
  - [ ] Add configuration import/export
  - [ ] Create preset sharing functionality
  - [ ] Add version control for configurations

## Dev Notes

### Architecture Context
**Source:** Story 3.4A - Advanced field configuration builds upon the core field management system with sophisticated validation, dependencies, and metadata management.

### Integration Points
- Extends FieldEditForm with advanced configuration tabs
- Integrates with useFieldValidation for complex validation rules
- Works with existing field CRUD operations from useFieldCRUD
- Enhances FieldTypeSelector with advanced type-specific options

### Advanced Configuration Features
**Complex Validation Types:**
- Pattern-based validation with regex builder
- Cross-field dependencies and calculations
- Conditional required fields
- Multi-step validation workflows
- Real-time validation with debouncing

**Field Type Enhancements:**
- Select: Categories, descriptions, dynamic options, multi-select
- Number: Units, precision, formatting, calculations, ranges
- Date: Timezones, business days, relative dates, ranges
- Text: Patterns, formatting masks, auto-completion
- Textarea: Rich text preview, character/word limits, resize behavior

### Data Model Extensions
```typescript
interface AdvancedFieldConfig {
  validationRules: ValidationRule[];
  dependencies: FieldDependency[];
  metadata: FieldMetadata;
  presetId?: string;
  version: number;
}

interface ValidationRule {
  id: string;
  type: 'pattern' | 'range' | 'dependency' | 'custom';
  config: Record<string, any>;
  errorMessage: string;
  priority: number;
}

interface FieldDependency {
  id: string;
  sourceFieldId: string;
  type: 'visibility' | 'required' | 'value' | 'validation';
  condition: DependencyCondition;
  action: DependencyAction;
}
```

### Testing Strategy
- Component testing for advanced configuration interfaces
- Hook testing for dependency logic and validation
- Integration testing for field interaction workflows
- E2E testing for complex field scenarios
- Performance testing for large dependency chains

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-26 | 1.0 | Initial story creation for advanced field configuration | Dev Agent |

## Dev Agent Record

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
*To be populated by dev agent during implementation*

### Completion Notes List
*To be populated as tasks are completed*

### File List
*To be populated with created and modified files*

## QA Results
*To be populated by QA agent after implementation review*