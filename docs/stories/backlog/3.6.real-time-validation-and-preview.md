# Story 3.6: Real-time Validation and Preview

## Status
Draft

## Story
**As a** railroad bridge engineer,
**I want** immediate feedback on my schema design and a preview of how it will look,
**so that** I can ensure my schema is valid and will work well for component data entry.

## Acceptance Criteria

1. **Debounced Validation System**
   - Implement 500ms debounce for schema validation during editing
   - Cancel previous validation requests when new changes occur
   - Performance optimization to prevent excessive API calls
   - Configurable debounce timing via environment variables

2. **Real-time Field Validation**
   - Validate field name uniqueness within schema as user types
   - Immediate feedback when duplicate names are entered
   - Clear error messaging for name conflicts with correction suggestions
   - Suggest alternative names when conflicts detected

3. **Schema-Level Validation**
   - Validate minimum field requirements (at least 1 field)
   - Check for required field distribution (warn if all fields optional)
   - Validate overall schema structure and relationships
   - Performance warnings for complex schemas (50+ fields)

4. **Live Schema Preview**
   - Real-time preview of schema as a component data entry form
   - Updates immediately when fields are added, modified, or reordered
   - Shows exactly how engineers will see the form when creating components
   - Responsive preview that adapts to different screen sizes

5. **Validation Feedback Interface**
   - Field-level error messages that appear immediately below fields
   - Clear, actionable error descriptions with correction guidance
   - Error icons and color coding following Material-UI patterns
   - Auto-dismiss errors when issues are resolved

6. **Schema Validation Summary**
   - Summary panel showing all current validation issues
   - Categorized errors (critical, warnings, suggestions)
   - Click-to-navigate to specific problematic fields
   - Overall validation status indicator (valid/invalid/checking)

7. **Example Data Population**
   - Auto-populate preview form with realistic example data
   - Different example data for different field types
   - User option to customize example data for better preview accuracy
   - Clear indication that data is for preview only

8. **Preview Mode Controls**
   - Easy toggle between edit mode and preview mode
   - Split-screen option showing edit and preview simultaneously
   - Full-screen preview mode for detailed review
   - Keyboard shortcuts for quick mode switching

## Tasks / Subtasks

- [ ] **Validation System Implementation** (AC: 1, 2, 3, 5, 6)
  - [ ] Create `src/hooks/schema/useSchemaValidation.ts` hook with debounced validation
  - [ ] Create `src/components/schema-management/ValidationFeedbackPanel.tsx` component
  - [ ] Create `src/components/schema-management/InlineValidationError.tsx` component
  - [ ] Implement field-level and schema-level validation rules
  - [ ] Add validation status indicators and error messaging

- [ ] **Schema Preview System** (AC: 4, 7, 8)
  - [ ] Create `src/components/schema-management/SchemaPreview.tsx` component
  - [ ] Create `src/components/schema-management/SchemaFormPreview.tsx` component
  - [ ] Create `src/hooks/schema/useSchemaPreview.ts` hook
  - [ ] Implement real-time form preview with example data
  - [ ] Add preview mode controls and responsive preview options

- [ ] **Preview Data Management** (AC: 7)
  - [ ] Create `src/utils/schemaPreviewUtils.ts` utility
  - [ ] Create `src/services/previewDataService.ts` service
  - [ ] Implement example data generation for all field types
  - [ ] Add custom example data management
  - [ ] Implement preview data validation and safety

- [ ] **Validation API Integration** (AC: 1, 3)
  - [ ] Create `src/services/validationService.ts` service
  - [ ] Implement debounced API calls with request cancellation
  - [ ] Add server-side validation integration
  - [ ] Implement validation result caching and invalidation
  - [ ] Add graceful API failure handling with fallbacks

- [ ] **User Interface Integration** (AC: 5, 6, 8)
  - [ ] Integrate validation with existing schema editing components
  - [ ] Add preview toggle controls to schema management interface
  - [ ] Implement validation summary panel
  - [ ] Add keyboard shortcuts and accessibility features

## Dev Notes

### Architecture Context
**Source:** [docs/architecture.md] - Multi-stage validation with business rules and data integrity checks ensuring data quality with immediate user feedback.

**Dependency:** This story builds on Stories 3.3 (Schema Creation and Basic Editing) and 3.4A-C (Field Management) to provide validation and preview for the schema editing workflow.

### Debounced Validation Strategy
**Source:** [docs/architecture.md#architectural-patterns] - Optimistic updates pattern with real-time feedback while maintaining performance.

**Implementation Strategy:**
- 500ms debounce for field-level validation
- Immediate validation for critical errors (duplicate names)
- Cancellation of pending requests on new changes
- Fallback to client-side validation when API unavailable

### Validation Engine Design
**Validation Types:**
- Client-side validation: immediate feedback for basic rules
- Server-side validation: business logic and database constraints
- Real-time validation: debounced API calls during editing
- Bulk validation: comprehensive schema validation

**Validation Rule Categories:**
- Critical: prevents schema save (duplicate names, empty schema)
- Warnings: performance or usability concerns (too many fields)
- Suggestions: best practice recommendations (required field distribution)

### Preview System Architecture
**Preview Generation Strategy:**
```typescript
interface SchemaPreviewData {
  schema: ComponentSchema;
  exampleData: Record<string, any>;
  previewMode: 'desktop' | 'mobile' | 'tablet';
  showValidation: boolean;
}
```

**Real-time Updates:**
- Preview updates immediately when schema changes
- Debounced example data generation for performance
- Responsive preview for different screen sizes
- Integration with existing form rendering components

### API Integration Requirements
**Expected API Endpoints:**
- `validateSchema(schemaData)` - Comprehensive schema validation
- `validateFieldName(schemaId, fieldName)` - Real-time name validation
- `generateExampleData(fieldType, config)` - Example data generation
- `previewSchema(schemaData)` - Server-side preview generation

### Form Preview Integration
**Integration with Existing Components:**
- Use same form rendering logic as actual component creation
- Integration with FlexibleComponentCard preview functionality
- Consistent styling with existing application forms
- Material-UI form components for accurate preview

### Performance Optimization
**Validation Performance:**
- Request cancellation for superseded validation calls
- Caching of validation results for unchanged schema sections
- Progressive validation for large schemas
- Performance monitoring for validation timing

**Preview Performance:**
- Memoization of preview component rendering
- Efficient example data generation and caching
- Lazy loading of preview components
- Responsive design optimization

### Error Handling Strategy
**Validation Error Types:**
- Network errors during validation API calls
- Invalid schema structure errors
- Field configuration errors
- Business rule violations

**Error Recovery:**
- Graceful degradation to client-side validation
- Retry logic for temporary network failures
- Clear user guidance for error resolution
- Fallback validation modes for offline scenarios

### Testing

**Testing Standards:** [docs/architecture.md#tech-stack] - Jest + React Testing Library with emphasis on real-time interactions and validation workflows.

**Testing Requirements for this Story:**
- Debounced validation timing and cancellation testing
- Real-time validation feedback testing
- Preview accuracy testing with various field configurations
- Error handling testing for API failures
- Performance testing for validation with large schemas
- Accessibility testing for validation feedback

**Test File Locations:**
- `src/hooks/schema/useSchemaValidation.test.ts`
- `src/components/schema-management/SchemaPreview.test.tsx`
- `src/services/validationService.test.ts`
- `src/utils/schemaPreviewUtils.test.ts`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-26 | 1.0 | Initial story creation with template compliance | Scrum Master |

## Dev Agent Record

### Agent Model Used
*To be populated by dev agent during implementation*

### Debug Log References
*To be populated by dev agent during implementation*

### Completion Notes List
*To be populated by dev agent during implementation*

### File List
*To be populated by dev agent during implementation*

## QA Results
*To be populated by QA agent after implementation review*